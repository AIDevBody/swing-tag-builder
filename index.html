<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guide</title>
  <!--
    This is the main guide page for calendar editors. It introduces
    the security policy, the tag generator, the onboarding process
    for new editors, and an overview of how the tagâ€‘based feed works.
    The page uses the same dark theme and localisation system as
    the tag builder, with strings defined in resources/local/[lang]/strings.json.
  -->
  <style>
    :root {
      --gap: 12px;
      --pad: 14px;
      --radius: 12px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    body {
      margin: 0;
      padding: 20px;
      background: #0b0f16;
      color: #eaf0ff;
    }
    a { color: #9bcbff; text-decoration: none; }
    .container {
      max-width: 960px;
      margin-left: auto;
      margin-right: auto;
    }
    header {
      margin-bottom: 24px;
    }
    .title-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: var(--gap);
    }
    .lang-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .card {
      background: #121827;
      border: 1px solid #1f2a44;
      border-radius: var(--radius);
      padding: var(--pad);
      margin-bottom: var(--gap);
      position: relative;
    }
    /* Special styling for security section */
    .card.security {
      border-color: #e54b4b;
    }
    h2 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 20px;
      font-weight: 600;
      color: #d0dbff;
    }
    p {
      margin-top: 0;
      margin-bottom: 14px;
      line-height: 1.4;
    }
    ul {
      margin-top: 0;
      margin-bottom: 14px;
      padding-left: 20px;
      line-height: 1.4;
    }
    button {
      background: #1a2540;
      color: #eaf0ff;
      border: 1px solid #2a3f66;
      border-radius: 10px;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
    }
    button:hover {
      background: #2a3f66;
      border-color: #3c548a;
    }
    /* Buttons within cards should sit at the bottom right without covering text */
    .button-row {
      display: flex;
      justify-content: flex-end;
      margin-top: var(--gap);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title-bar">
        <h1 id="mainTitle">Swing Calendar Editors Guide</h1>
        <div class="lang-container">
          <label id="mainLangLabel" for="lang">Language:</label>
          <select id="lang"></select>
        </div>
      </div>
    </header>
    <!-- Security section -->
    <section id="securitySection" class="card security">
      <h2 id="securityTitle"></h2>
      <p id="securityText"></p>
      <div class="button-row">
        <button id="securityButton"></button>
      </div>
    </section>
    <!-- Tag generator section -->
    <section id="tagSection" class="card">
      <h2 id="tagTitle"></h2>
      <p id="tagText"></p>
      <div class="button-row">
        <button id="tagButton"></button>
      </div>
    </section>
    <!-- Editor onboarding section -->
    <section id="editorSection" class="card">
      <h2 id="editorTitle"></h2>
      <p id="editorText"></p>
      <div class="button-row">
        <button id="downloadAgreementButton"></button>
      </div>
    </section>
    <!-- System overview section -->
    <section id="systemSection" class="card">
      <h2 id="systemTitle"></h2>
      <p id="systemText"></p>
      <div class="button-row">
        <button id="systemButton"></button>
      </div>
    </section>
    <!-- Followers explanation section -->
    <section id="followersSection" class="card">
      <h2 id="followersTitle"></h2>
      <p id="followersIntro"></p>
      <ul id="followersSteps"></ul>
      <div class="button-row">
        <button id="followersButton"></button>
      </div>
    </section>
  </div>

  <script>
  // Localisation and navigation for the guide page
  let languages = ['en','de'];
  let currentLang = 'en';
  let strings = {};

  function loadSavedLang() {
    try {
      const saved = localStorage.getItem('editorGuideLang');
      if (saved) currentLang = saved;
    } catch (err) {}
  }

  function saveLang() {
    try {
      localStorage.setItem('editorGuideLang', currentLang);
    } catch (err) {}
  }

  async function loadStrings(lang) {
    try {
      const res = await fetch(`resources/local/${lang}/strings.json`, {cache:'no-store'});
      if (!res.ok) throw new Error('Failed to load strings');
      strings = await res.json();
    } catch (err) {
      console.warn('Could not load localisation for', lang, err);
      if (lang !== 'en') {
        await loadStrings('en');
      }
    }
  }

  function initLanguages() {
    const sel = document.getElementById('lang');
    sel.innerHTML = '';
    languages.forEach(code => {
      const opt = document.createElement('option');
      opt.value = code;
      opt.textContent = code;
      sel.appendChild(opt);
    });
    sel.value = currentLang;
    sel.addEventListener('change', async () => {
      currentLang = sel.value;
      saveLang();
      await loadStrings(currentLang);
      updateText();
    });
  }

  function updateText() {
    document.getElementById('mainTitle').textContent = strings.main_title || 'Swing Calendar Editors Guide';
    document.getElementById('mainLangLabel').textContent = strings.language_label || 'Language:';
    // security section
    document.getElementById('securityTitle').textContent = strings.security_section_title || 'Security & Onboarding';
    document.getElementById('securityText').textContent = strings.security_section_text || '';
    document.getElementById('securityButton').textContent = strings.security_button || 'Read security policy';
    // tag generator
    document.getElementById('tagTitle').textContent = strings.tag_generator_section_title || 'Tag Generator';
    document.getElementById('tagText').textContent = strings.tag_generator_section_text || '';
    document.getElementById('tagButton').textContent = strings.tag_generator_button || 'Open Tag Builder';
    // editor onboarding
    document.getElementById('editorTitle').textContent = strings.editor_section_title || 'Interested in becoming an editor?';
    document.getElementById('editorText').textContent = strings.editor_section_text || '';
    document.getElementById('downloadAgreementButton').textContent = strings.download_agreement_button || 'Download agreement';
    // system overview
    document.getElementById('systemTitle').textContent = strings.system_section_title || 'How the system & tags work';
    document.getElementById('systemText').textContent = strings.system_section_text || '';
    document.getElementById('systemButton').textContent = strings.learn_more_button || 'Learn more';
    // followers feed explanation
    document.getElementById('followersTitle').textContent = strings.followers_section_title || 'How followers pick a feed';
    document.getElementById('followersIntro').textContent = strings.followers_section_intro || 'Fans build a personalised feed by following the same tags you add to events.';
    const stepList = document.getElementById('followersSteps');
    stepList.innerHTML = '';
    const fallbackSteps = [
      'Open find-me-dance and browse the public feed to discover tags.',
      'Select the tag filters (city, style, intensity, etc.) that match the scenes you want to follow.',
      'Save the filter group to keep receiving a personalised stream of events.'
    ];
    const steps = strings.followers_section_steps || fallbackSteps;
    steps.forEach(step => {
      const li = document.createElement('li');
      li.textContent = step;
      stepList.appendChild(li);
    });
    document.getElementById('followersButton').textContent = strings.followers_section_button || 'Visit find-me-dance on GitHub';
  }

  function attachHandlers() {
    document.getElementById('securityButton').addEventListener('click', () => {
      window.location.href = 'security.html';
    });
    document.getElementById('tagButton').addEventListener('click', () => {
      window.location.href = 'tag-builder.html';
    });
    document.getElementById('downloadAgreementButton').addEventListener('click', () => {
      // open the PDF in new tab for download; use relative path
      window.open('Editor_Access_Agreement_DE.pdf', '_blank');
    });
    document.getElementById('systemButton').addEventListener('click', () => {
      window.location.href = 'quick-model.html';
    });
    document.getElementById('followersButton').addEventListener('click', () => {
      window.open('https://github.com/alijenabidehkordi/find-me-dance', '_blank', 'noopener');
    });
  }

  (async () => {
    loadSavedLang();
    await loadStrings(currentLang);
    initLanguages();
    updateText();
    attachHandlers();
  })();
  </script>
</body>
</html>
